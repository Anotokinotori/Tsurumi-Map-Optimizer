<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鶴観調整プラン計算ツール（周期ホールド対応）</title>
    <!-- CSSファイルを外部から読み込み -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="site-header backdrop-blur">
        <h1>
            <span class="title-long">鶴観調整ツール（周期ホールド対応）</span>
            <span class="title-short">鶴観調整ツール</span>
        </h1>
        <div class="header-info">
            <span class="header-version">Ver. 1.1.0</span>
            <span class="credit-separator">|</span>
            <span>製作者: <a href="https://x.com/PIpXlMz1tB5ASjF" target="_blank" rel="noopener noreferrer">あの時の鳥です</a></span>
        </div>
    </header>

    <div id="info-banner" class="info-banner">
        <p>鶴観の精鋭の仕組みについて詳しく知りたい方は、<a href="https://youtu.be/2xqllaCTP5c?si=m9yyxXo5GS0rwFG9" target="_blank" rel="noopener noreferrer">こちらの解説動画</a>をご覧ください。</p>
        <button id="close-banner-btn" class="close-banner-btn" title="閉じる">&times;</button>
    </div>

    <main>
        <div class="container backdrop-blur">

            <!-- Page 1: Start Screen -->
            <div id="start-page" class="page active">
                <div class="page-content-wrapper">
                    <div class="start-header">
                        <h1>鶴観調整ツール</h1>
                        <p class="subtitle">※PCでの使用をおすすめします<br>現在と理想の配置を入力すると、最短調整スケジュールを計算します</p>
                    </div>
                    
                    <div class="steps-container">
                        <div class="step" data-step="1"> <div class="step-icon">①</div> <div class="step-label">現在の配置を入力</div> </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="2"> <div class="step-icon">②</div> <div class="step-label">理想の配置を入力</div> </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="3"> <div class="step-icon">③</div> <div class="step-label">調整スケジュール</div> </div>
                    </div>

                    <div class="start-buttons">
                        <button id="go-to-current-btn" class="btn btn-primary">調整を始める</button>
                        <button id="load-plan-btn" class="btn btn-secondary">保存したプランを読み込む</button>
                    </div>

                    <div class="start-footer">
                        <div class="multi-mode-toggle">
                            <input type="checkbox" id="boat-mode-checkbox">
                            <label for="boat-mode-checkbox">ボートでの配置調整を許可</label>
                        </div>
                        <div class="multi-mode-toggle">
                            <input type="checkbox" id="multiplayer-mode-checkbox">
                            <label for="multiplayer-mode-checkbox">周期ホールドを有効化</label>
                            <a href="https://youtu.be/2xqllaCTP5c?si=_P-LgtUukOdhN57k&t=1194" class="help-icon" target="_blank" rel="noopener noreferrer" title="周期ホールドの解説動画">?</a>
                        </div>
                         <button id="guide-btn" class="btn btn-secondary-link">使い方ガイド</button>
                    </div>
                </div>
            </div>

            <!-- Page 2: Current Configuration Input -->
            <div id="current-config-page" class="page">
                <div class="page-content-wrapper">
                    <div class="page-header">
                        <button id="back-to-start-btn" class="btn-back" aria-label="戻る"></button>
                        <div class="steps-container">
                            <div class="step" data-step="1"> <div class="step-icon">①</div> <div class="step-label">現在の配置を入力</div> </div>
                            <div class="step-arrow">→</div>
                            <div class="step" data-step="2"> <div class="step-icon">②</div> <div class="step-label">理想の配置を入力</div> </div>
                            <div class="step-arrow">→</div>
                            <div class="step" data-step="3"> <div class="step-icon">③</div> <div class="step-label">調整スケジュール</div> </div>
                        </div>
                        <div class="header-placeholder"></div>
                    </div>

                    <div class="view-switcher">
                        <button id="current-map-tab" class="view-tab active" data-view="map">マップ表示</button>
                        <button id="current-list-tab" class="view-tab" data-view="list">リスト表示</button>
                    </div>

                    <div class="input-views-container">
                        <div id="current-map-view" class="input-view active">
                            <div class="map-container" id="current-map-container">
                                 <div class="map-guide-text">アイコンをタップして選択</div>
                                 <img src="https://github.com/Anotokinotori/Tsurumi-Route-Optimizer/blob/main/input_page_map.png?raw=true" alt="鶴観マップ" class="map-bg">
                            </div>
                        </div>
                        <div id="current-list-view" class="input-view">
                            <div class="config-list" id="current-config-list">
                            </div>
                        </div>
                    </div>
                    
                    <div class="page-footer">
                        <div class="left-action">
                            <div class="quick-fill-buttons show-flex-on-desktop">
                                <span class="quick-fill-label">一括入力:</span>
                                <button id="fill-all-a-btn" class="btn btn-secondary btn-small">A</button>
                                <button id="fill-all-b-btn" class="btn btn-secondary btn-small">B</button>
                                <button id="fill-all-c-btn" class="btn btn-secondary btn-small">C</button>
                            </div>
                        </div>
                        <div class="center-action">
                            <div class="progress-text" id="progress-text">入力完了: 0 / 10</div>
                        </div>
                        <div class="right-action">
                            <div id="validation-message" class="validation-message"></div>
                            <button id="go-to-ideal-btn" class="btn btn-primary" disabled>理想の配置へ</button>
                        </div>
                   </div>
                </div>
            </div>
            
            <!-- Page 3: Ideal Configuration Input -->
            <div id="ideal-config-page" class="page">
                <div class="page-content-wrapper">
                     <div class="page-header">
                        <button id="back-to-current-btn" class="btn-back" aria-label="戻る"></button>
                        <div class="steps-container">
                            <div class="step" data-step="1"> <div class="step-icon">①</div> <div class="step-label">現在の配置を入力</div> </div>
                            <div class="step-arrow">→</div>
                            <div class="step" data-step="2"> <div class="step-icon">②</div> <div class="step-label">理想の配置を入力</div> </div>
                            <div class="step-arrow">→</div>
                            <div class="step" data-step="3"> <div class="step-icon">③</div> <div class="step-label">調整スケジュール</div> </div>
                        </div>
                        <div class="header-placeholder"></div>
                    </div>

                    <div class="view-switcher">
                        <button id="ideal-map-tab" class="view-tab active" data-view="map">マップ表示</button>
                        <button id="ideal-list-tab" class="view-tab" data-view="list">リスト表示</button>
                    </div>

                    <div class="input-views-container">
                        <div id="ideal-map-view" class="input-view active">
                            <div class="map-container" id="ideal-map-container">
                                 <div class="map-guide-text">アイコンをタップして選択</div>
                                 <img src="https://github.com/Anotokinotori/Tsurumi-Route-Optimizer/blob/main/input_page_map.png?raw=true" alt="鶴観マップ" class="map-bg">
                            </div>
                        </div>
                        <div id="ideal-list-view" class="input-view">
                            <div class="config-list" id="ideal-config-list">
                            </div>
                        </div>
                    </div>

                     <div class="page-footer">
                        <div class="left-action">
                             <button class="btn btn-secondary" id="set-recommended-btn">環境配置</button>
                             <button class="btn btn-secondary show-on-desktop" id="copy-current-btn">現在配置をコピー</button>
                        </div>
                        <div class="center-action">
                            <div class="progress-text" id="ideal-progress-text">入力完了: 0 / 10</div>
                        </div>
                        <div class="right-action">
                            <button id="calculate-plan-btn" class="btn btn-primary">調整プランを計算</button>
                        </div>
                   </div>
                </div>
            </div>

            <!-- Page 4: Result Page -->
            <div id="result-page" class="page">
                <div class="page-content-wrapper">
                     <div class="page-header">
                        <button id="back-to-ideal-btn" class="btn-back" aria-label="戻る"></button>
                         <div class="steps-container">
                            <div class="step" data-step="1"> <div class="step-icon">①</div> <div class="step-label">現在の配置を入力</div> </div>
                            <div class="step-arrow">→</div>
                            <div class="step" data-step="2"> <div class="step-icon">②</div> <div class="step-label">理想の配置を入力</div> </div>
                            <div class="step-arrow">→</div>
                            <div class="step" data-step="3"> <div class="step-icon">③</div> <div class="step-label">調整スケジュール</div> </div>
                        </div>
                        <div class="header-placeholder"></div>
                    </div>

                    <div class="result-grid">
                        <div class="result-layout-container">
                            <div class="result-map-container">
                                <img src="https://github.com/Anotokinotori/Tsurumi-Route-Optimizer/blob/main/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202025-09-21%20161308.png?raw=true" alt="鶴観マップ 結果表示" class="map-bg">
                            </div>
                            <div class="result-actions-container">
                                <div id="solo-mode-notice" class="solo-notice show-on-desktop">
周期ホールドを使わない調整方法です。使用すると期間をもっと短縮できるかもしれません。<a href="https://youtu.be/2xqllaCTP5c?si=UyMkRCct-Z1Pp5HI&t=1194" target="_blank" rel="noopener noreferrer">詳しくは動画で</a>
                                </div>
                                <button id="recalculate-alternate-mode-btn" class="btn"></button>
                                <div class="result-actions-row">
                                    <button id="save-plan-btn" class="btn btn-secondary">結果を保存</button>
                                    <button id="reset-btn" class="btn btn-secondary">リセット</button>
                                </div>
                            </div>
                        </div>

                        <div id="result-details" class="result-details-container">
                             <div id="result-summary">
                                 <button id="save-plan-icon-btn" class="save-icon-btn" title="結果を保存"></button>
                                 <span id="result-summary-text"></span>
                             </div>
                             <div class="result-table-container">
                                 <table class="result-table">
                                     <thead>
                                         <tr> <th>日付</th> <th>モード</th> <th>2P(ホールド役)の行動</th> <th>1P(ホスト)の行動</th> <th>詳細</th> </tr>
                                     </thead>
                                     <tbody id="result-tbody"></tbody>
                                 </table>
                             </div>
                             <p class="result-footer-link">
                                鶴観のロード範囲（移動ルート）について詳しく知りたい方は<a href="https://note.com/nekoshita_g/n/n485ff9b3df29" target="_blank" rel="noopener noreferrer">こちら</a>
                             </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- Modals -->
    <div id="guide-modal" class="modal backdrop-blur">
        <div class="modal-content">
            <span class="modal-close" data-target="guide-modal">&times;</span>
            <h2>使い方ガイド</h2>
            <p>このツールは、鶴観の精鋭エネミーの配置を、最短日数で理想の配置に調整するためのスケジュールを計算します。</p>
            
            <hr>

            <h3>Step 1: 現在の配置を入力</h3>
            <p>まず、あなたの世界の現在のエネミー配置を10ヶ所すべて入力します。「マップ表示」または「リスト表示」で入力できます。</p>
            <img src="https://github.com/Anotokinotori/Tsurumi-Route-Optimizer/blob/main/%E4%BD%BF%E3%81%84%E6%96%B9%E3%82%AC%E3%82%A4%E3%83%89GIF/%E7%8F%BE%E5%9C%A8.gif?raw=true" alt="マップ入力画面" style="width:100%; border-radius: 8px; margin-top: 10px;">
            <p style="margin-top: 10px;">マップ上のアイコンをタップすると、詳細なマップが表示され、A/B/Cのパターンを選択できます。選択に迷ったら、スクリーンショットで実際のゲーム画面を確認できます。</p>
            
            <hr>

            <h3>Step 2: 理想の配置を入力</h3>
            <p>次に、目標とする理想の配置を入力します。すべて入力する必要はなく、変更したい場所だけ入力すればOKです。</p>
            <p>便利な「環境配置を自動入力」ボタンも活用してください。</p>
            <img src="https://github.com/Anotokinotori/Tsurumi-Route-Optimizer/blob/main/%E4%BD%BF%E3%81%84%E6%96%B9%E3%82%AC%E3%82%A4%E3%83%89GIF/%E7%90%86%E6%83%B3.gif?raw=true" alt="理想配置の入力" style="width:100%; border-radius: 8px; margin-top: 10px;">
            
            <hr>
            
            <h3>Step 3: スケジュールを計算・確認</h3>
            <p>入力が終わったら、「調整プランを計算」ボタンを押します。</p>
            <p>スタートページで「周期ホールドを有効にする」にチェックを入れていると、マルチプレイを前提とした最短ルートを計算します。</p>
            <img src="https://github.com/Anotokinotori/Tsurumi-Route-Optimizer/blob/main/%E4%BD%BF%E3%81%84%E6%96%B9%E3%82%AC%E3%82%A4%E3%83%89GIF/%E7%B5%90%E6%9E%9C.gif?raw=true" alt="結果表示画面" style="width:100%; border-radius: 8px; margin-top: 10px;">
        </div>
    </div>
    
    <div id="zoom-view" class="modal backdrop-blur">
        <div class="modal-content">
            <span class="modal-close" data-target="zoom-view">&times;</span>
            <h3 id="zoom-title"></h3>
            <div id="zoom-map-container" class="image-container">
                <div class="image-loader">読み込み中...</div>
                <img src="https://placehold.co/800x500/e9e9e9/333?text=Zoomed+Area" alt="ズームマップ">
            </div>
        </div>
    </div>

    <div id="screenshot-popup" class="modal backdrop-blur">
        <div class="modal-content">
             <span class="modal-close" data-target="screenshot-popup">&times;</span>
             <h3 id="screenshot-title"></h3>
             <div class="image-container">
                <div class="image-loader">読み込み中...</div>
                <img id="screenshot-img" src="https://placehold.co/500x300/eef2ff/312e81?text=In-Game+Screenshot" alt="ゲーム内スクリーンショット">
             </div>
             <button id="confirm-pattern-btn" class="btn btn-primary" style="margin-top: 15px;">確定</button>
        </div>
    </div>
    
    <div id="loading-modal" class="modal">
         <div class="modal-content" style="text-align: center;">
            <h2 style="font-size: 2.5em; margin-bottom: 10px;">計算中...</h2>
            <p id="loading-text">最適なルートを探索しています。<br>組み合わせが複雑な場合、十数秒かかることがあります。</p>
            <div class="loader"></div>
            <div id="calculation-progress"></div>
         </div>
    </div>
    
    <div id="day-detail-modal" class="modal backdrop-blur">
         <div class="modal-content">
              <span class="modal-close" data-target="day-detail-modal">&times;</span>
              <h2 id="day-detail-title"></h2>
              <div id="day-detail-content"></div>
       </div>
    </div>

    <div id="credit-modal" class="modal backdrop-blur">
        <div class="modal-content">
            <span class="modal-close" data-target="credit-modal">&times;</span>
            <h2>Special Thanks</h2>
            <p>このツールの開発にあたり、「ねこした」さんより多大なるご協力をいただきました。<br>心より感謝申し上げます。</p>
            
            <hr style="margin: 20px 0;">
            
            <h4>■ 画像・情報提供</h4>
            <p>ツール内で使用している各配置の画像や、精鋭エネミーの出現パターンに関する情報は、以下のnote記事を参考にさせていただきました。非常に分かりやすくまとめられており、開発の大きな助けとなりました。</p>
            <p style="padding-left: 1em;"><strong>note記事:</strong> <a href="https://note.com/nekoshita_g/n/nba4aff6a13ff" target="_blank" rel="noopener noreferrer">【原神】鶴観の精鋭の仕組みと調整方法</a></p>
            
            <h4>■ 調整方法の解説</h4>
            <p>本ツールの計算ロジックは、以下の動画で解説されている調整方法を基にプログラムとして実装したものです。鶴観調整の仕組みそのものについて、大変分かりやすく解説されていますので、ぜひご覧ください。</p>
            <p style="padding-left: 1em;"><strong>解説動画:</strong> <a href="https://youtu.be/2xqllaCTP5c?si=jY3Vn64mj6y91Vte" target="_blank" rel="noopener noreferrer">【原神】鶴観の精鋭の仕組みと調整方法 (YouTube)</a></p>
            
            <hr style="margin: 20px 0;">
            
            <p style="text-align: center;">
                <a href="https://www.youtube.com/@nekoshita_g" target="_blank" rel="noopener noreferrer" class="btn btn-secondary" style="text-decoration: none;">ねこしたさんのYouTubeチャンネルはこちら</a>
            </p>
        </div>
    </div>
    
    <div id="load-plan-modal" class="modal backdrop-blur">
        <div class="modal-content">
            <span class="modal-close" data-target="load-plan-modal">&times;</span>
            <h2>保存したプランを読み込む</h2>
            <ul id="saved-plans-list">
                <!-- Saved plans will be dynamically inserted here -->
            </ul>
            <p id="no-saved-plans">保存されたプランはありません。</p>
        </div>
    </div>


    <footer class="site-credit-footer backdrop-blur">
        <p>
            <span id="credit-modal-trigger">Special Thanks: ねこしたさん (詳細はこちら)</span>
            <span class="credit-separator">|</span>
            <span>鶴観を研究してくださった先人の方々</span>
        </p>
    </footer>

    <!-- JavaScriptファイルを外部から読み込み -->
    <!-- データ定義を先に、メインロジックを後に読み込む -->
    <script src="js/data.js"></script>
    <script src="js/main.js"></script>
</body>
</html>



